#!/usr/bin/env zsh

# First, setup some directories I want
mkdir -p $HOME/personal
mkdir -p $HOME/src
mkdir -p $HOME/.config/powerline
touch $HOME/personal/dotfiles/.credentials


# Install OSX packages
if [[ `uname` == 'Darwin' ]]; then
	echo "Installing Homebrew"
	ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
	# Install python for deps
	brew install python3
	# Install neovim
	brew install neovim/neovim/neovim
  brew install fzf
fi
if [[ `uname` == "Linux" ]]; then
	sudo apt-get install python-dev python-pip python3-dev python3-pip software-properties-common
	sudo add-apt-repository ppa:neovim-ppa/unstable
	sudo apt-get update
	sudo apt-get install neovim
fi


# Upgrade pip
pip3 install --upgrade pip

# install powerline and fonts
pip3 install powerline-status
pushd $HOME/personal
git clone git@github.com:powerline/fonts.git
cd fonts && ./install.sh
popd

pip install neovim
pip3 install neovim

# Install prezto
git clone --recursive https://github.com/sorin-ionescu/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"

setopt EXTENDED_GLOB
for rcfile in "${ZDOTDIR:-$HOME}"/.zprezto/runcoms/^README.md(.N); do
  ln -s "$rcfile" "${ZDOTDIR:-$HOME}/.${rcfile:t}"
done

chsh -s /bin/zsh

# install RVM because ruby <3
if [[ `which rvm` == '' ]]; then
  echo "Installing RVM"
  curl -sSL https://get.rvm.io | bash -s stable
else
  echo "RVM already installed"
fi

# Install vim-plug to manage Vim bundles
curl -fLo ~/.local/share/nvim/site/autoload/plug.vim --create-dirs \
    https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# Symlink my vimrc
rm $HOME/.vimrc
ln -s $HOME/personal/dotfiles/.vimrc $HOME/.vimrc
mkdir $HOME/.config/nvim
ln -s $HOME/.vimrc $HOME/.config/nvim/init.vim

# Install bundles managed by Vundler
nvim +PlugInstall +qall

# Install TEM to manage AWS accounts
curl -L https://raw.github.com/tapjoy/tem/master/em.sh > ~/.em.sh

# Install TPM
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Symlink my zshrc
ln -s $HOME/personal/dotfiles/.zshrc ~/.zshrc

# Symlink tmux config
ln -s $HOME/personal/dotfiles/.tmux.conf ~/.tmux.conf

# Symlink gitconfig
ln -s $HOME/personal/dotfiles/.gitconfig ~/.gitconfig
